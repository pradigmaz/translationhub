{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/teams_dark_theme.css' %}">
{% endblock %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:teams_team_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<div class="content">
    <h1>{{ title }}</h1>
    
    <div class="module aligned" style="margin-bottom: 20px;">
        <h2>{% trans "Команды для удаления" %}</h2>
        <div class="form-row">
            <div><strong>{% trans "Количество команд:" %}</strong> {{ team_count }}</div>
            <div><strong>{% trans "Общее количество участников:" %}</strong> {{ total_members }}</div>
        </div>
        
        <h3>{% trans "Список команд:" %}</h3>
        <table>
            <thead>
                <tr>
                    <th>{% trans "Название команды" %}</th>
                    <th>{% trans "Статус" %}</th>
                    <th>{% trans "Создатель" %}</th>
                    <th>{% trans "Участников" %}</th>
                    <th>{% trans "Дата создания" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for team in teams %}
                <tr>
                    <td><strong>{{ team.name }}</strong></td>
                    <td>
                        <span class="status-badge status-{{ team.status }}">
                            {{ team.get_status_display }}
                        </span>
                    </td>
                    <td>{{ team.creator.username }}</td>
                    <td>
                        {{ team.members.count }}
                        {% if team.status != 'active' %}
                            <small style="color: #6c757d;">
                                (активных: {{ team.members.filter.teammembership__is_active=True.count|default:0 }})
                            </small>
                        {% endif %}
                    </td>
                    <td>{{ team.created_at|date:"d.m.Y" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="module aligned">
        <div class="form-row">
            <div class="warning-box">
                <h3 style="margin-top: 0;">⚠️ {% trans "Внимание!" %}</h3>
                <p><strong>{% blocktrans count counter=team_count %}Вы собираетесь удалить {{ counter }} команду.{% plural %}Вы собираетесь удалить {{ counter }} команд.{% endblocktrans %}</strong></p>
                <p>{% trans "Это действие:" %}</p>
                <ul>
                    <li>{% trans "Удалит все выбранные команды безвозвратно" %}</li>
                    <li>{% blocktrans count counter=total_members %}Удалит все связи участников с этими командами ({{ counter }} запись){% plural %}Удалит все связи участников с этими командами ({{ counter }} записей){% endblocktrans %}</li>
                    <li>{% trans "Не может быть отменено" %}</li>
                </ul>
            </div>
        </div>
        
        <form method="post">
            {% csrf_token %}
            {% for team in queryset %}
                <input type="hidden" name="{{ action_checkbox_name }}" value="{{ team.pk }}">
            {% endfor %}
            <input type="hidden" name="action" value="delete_selected_teams_with_confirmation">
            <input type="hidden" name="post" value="yes">
            
            <div class="submit-row">
                <input type="submit" value="{% trans 'Да, удалить все выбранные команды' %}" 
                       class="delete-button"
                       onclick="return confirm('{% blocktrans count counter=team_count %}Вы уверены, что хотите удалить {{ counter }} команду? Это действие нельзя отменить!{% plural %}Вы уверены, что хотите удалить {{ counter }} команд? Это действие нельзя отменить!{% endblocktrans %}');">
                <a href="{% url 'admin:teams_team_changelist' %}" 
                   class="cancel-link">
                   {% trans "Отмена" %}
                </a>
            </div>
        </form>
    </div>
</div>

<style>
/* Статусные бейджи */
.status-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
}

.status-active {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-inactive {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.status-disbanded {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.warning-box {
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
    border: 1px solid;
}

/* Светлая тема */
body:not([data-theme="dark"]) .warning-box {
    background-color: #ffeaa7;
    border-color: #fdcb6e;
    color: #2d3748;
}

body:not([data-theme="dark"]) .warning-box h3 {
    color: #e17055;
}

/* Тёмная тема */
body[data-theme="dark"] .warning-box,
[data-theme="dark"] .warning-box {
    background-color: #4a5568;
    border-color: #ed8936;
    color: #e2e8f0;
}

body[data-theme="dark"] .warning-box h3,
[data-theme="dark"] .warning-box h3 {
    color: #fbb6ce;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

table th, table td {
    padding: 8px;
    text-align: left;
}

/* Светлая тема для таблиц */
body:not([data-theme="dark"]) table th, 
body:not([data-theme="dark"]) table td {
    border-bottom: 1px solid #ddd;
}

body:not([data-theme="dark"]) table th {
    background-color: #f8f9fa;
    color: #2d3748;
}

body:not([data-theme="dark"]) table tr:nth-child(even) {
    background-color: #f8f9fa;
}

/* Тёмная тема для таблиц */
body[data-theme="dark"] table th,
body[data-theme="dark"] table td,
[data-theme="dark"] table th,
[data-theme="dark"] table td {
    border-bottom: 1px solid #4a5568;
}

body[data-theme="dark"] table th,
[data-theme="dark"] table th {
    background-color: #2d3748;
    color: #e2e8f0;
}

body[data-theme="dark"] table td,
[data-theme="dark"] table td {
    color: #cbd5e0;
}

body[data-theme="dark"] table tr:nth-child(even),
[data-theme="dark"] table tr:nth-child(even) {
    background-color: #2d3748;
}

/* Тёмная тема для статусных бейджей */
body[data-theme="dark"] .status-active,
[data-theme="dark"] .status-active {
    background-color: #2d5a3d;
    color: #a3d9a5;
    border-color: #4a7c59;
}

body[data-theme="dark"] .status-inactive,
[data-theme="dark"] .status-inactive {
    background-color: #5d4e37;
    color: #f4d03f;
    border-color: #8b7355;
}

body[data-theme="dark"] .status-disbanded,
[data-theme="dark"] .status-disbanded {
    background-color: #5a2d2d;
    color: #f1948a;
    border-color: #7c4a4a;
}

/* Кнопки */
.delete-button {
    background-color: #dc3545;
    border-color: #dc3545;
    color: white;
    padding: 10px 15px;
    border-radius: 4px;
    border: 1px solid;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.cancel-link {
    background-color: #6c757d;
    border-color: #6c757d;
    color: white;
    margin-left: 10px;
    padding: 10px 15px;
    text-decoration: none;
    border-radius: 4px;
    border: 1px solid;
    display: inline-block;
}

/* Hover эффекты для кнопок */
.delete-button:hover {
    background-color: #c82333;
    border-color: #bd2130;
    color: white;
}

.cancel-link:hover {
    background-color: #5a6268;
    border-color: #545b62;
    color: white;
    text-decoration: none;
}
</style>
{% endblock %}